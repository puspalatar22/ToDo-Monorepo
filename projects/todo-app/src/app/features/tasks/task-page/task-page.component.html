<div class="container">
  <!-- Header -->
  <div class="header">
    <h2 class="title">{{ "TASK_LIST.TITLE" | translate }}</h2>

    <div class="header-actions">
      <ui-todo-button style="margin-right: 1rem;"
        [label]="
          currentLang === 'en'
            ? 'TASK_LIST.TRANSLATE_HI'
            : 'TASK_LIST.TRANSLATE_EN'
        "
        type="button"
        color="primary"
        (click)="switchLanguage()"
      >
      </ui-todo-button>

      <ui-todo-button
        [label]="'TASK_LIST.ADD_NEW'"
        type="button"
        color="primary"
        (click)="openAddModal()"
      >
      </ui-todo-button>
    </div>
  </div>

  <!-- Task Table -->
  <ng-container *ngIf="tasks$ | async as tasks">
    <table class="task-table" *ngIf="tasks.length > 0; else emptyState">
      <thead>
        <tr>
          <th>{{ "TASK_LIST.TITLE" | translate }}</th>
          <th>{{ "TASK_LIST.DESCRIPTION" | translate }}</th>
          <th>{{ "TASK_LIST.STATUS" | translate }}</th>
          <th>{{ "TASK_LIST.CREATED" | translate }}</th>
          <th>{{ "TASK_LIST.ACTIONS" | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of tasks" [class.completed]="task.completed">
          <td>{{ task.title }}</td>
          <td>{{ task.description || "-" }}</td>
          <td>
            <span class="status" [class.done]="task.completed">
              {{
                task.completed
                  ? ("TASK_LIST.COMPLETED" | translate)
                  : ("TASK_LIST.PENDING" | translate)
              }}
            </span>
          </td>
          <td>{{ task.createdAt | date: "short" }}</td>
          <td class="actions">
            <ui-todo-button
              [label]="task.completed ? 'TASK_LIST.UNDO' : 'TASK_LIST.COMPLETE'"
              type="button"
              color="complete"
              (click)="toggleTask(task.id)"
            >
            </ui-todo-button>

            <ui-todo-button
              [label]="'TASK_LIST.DELETE'"
              type="button"
              color="delete"
              (click)="deleteTask(task.id)"
            >
            </ui-todo-button>
            <ui-todo-button
              [label]="'TASK_LIST.EDIT'"
              type="button"
              color="edit"
              (click)="openEditModal(task)"
            >
            </ui-todo-button>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #emptyState>
      <div class="empty">{{ "TASK_LIST.NO_TASKS" | translate }}</div>
    </ng-template>
  </ng-container>

  <!-- Modal -->
  <div class="backdrop" *ngIf="showModal" (click)="closeModal()"></div>

  <div class="modal" *ngIf="showModal">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          {{
            selectedTask
              ? ("TASK_LIST.EDIT" | translate)
              : ("TASK_LIST.ADD_NEW" | translate)
          }}
        </h3>
        <button class="close-btn" (click)="closeModal()">Ã—</button>
      </div>

      <!-- Reusable Form Component -->
      <ui-todo-form [task]="selectedTask" (submitTask)="handleSaveTask($event)">
      </ui-todo-form>
    </div>
  </div>
</div>
